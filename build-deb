#/bin/sh

TIKA_VERSION=2.1.0
TIKA_URL=https://archive.apache.org/dist/tika/$TIKA_VERSION/tika-server-standard-$TIKA_VERSION.jar

VERSION=`date +%y.%m.%d`
PACKAGE=tika-server.deb_${VERSION}.deb
BUILDDIR=/tmp/build-tika-server-$$.deb

echo "Building ${PACKAGE} in temp directory ${BUILDDIR}"

mkdir ${BUILDDIR}
cp -a DEBIAN ${BUILDDIR}/
cp -a etc ${BUILDDIR}/

mkdir -p ${BUILDDIR}/var/cache/tesseract
mkdir -p ${BUILDDIR}/usr/share/java/

# Download Tika
wget -P ${BUILDDIR}/usr/share/java $TIKA_URL

# Create version agnostic link
ln -s tika-server-standard-$TIKA_VERSION.jar ${BUILDDIR}/usr/share/java/tika-server-standard.jar

#
# set rights
#

chown -R root:root ${BUILDDIR}/
chmod g+r ${BUILDDIR}/usr/share/java/tika-server*
chmod o+r ${BUILDDIR}/usr/share/java/tika-server*


#
# Build deb
#

dpkg -b ${BUILDDIR} ${PACKAGE}
